ğŸ“Œ GUIDE RAPIDE - DONNÃ‰ES PERDUES APRÃˆS FERMETURE .EXE

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                     DIAGNOSTIC RAPIDE                          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ”´ PROBLÃˆME
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Utilisateur ajoute des donnÃ©es dans l'app desktop â†’ Ferme â†’ Les donnÃ©es
disparaissent aprÃ¨s redÃ©marrage.

ğŸ” CAUSE IDENTIFIÃ‰E
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Votre code utilise 2 systÃ¨mes de base de donnÃ©es:
1. DatabaseService (SQLite) - electron/database.js
2. DataManager (JSON) - electron/main.cjs

Les deux ne sont PAS synchronisÃ©s â†’ Conflit de donnÃ©es


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                     SOLUTION RAPIDE (15 MIN)                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ Ã‰TAPE 1: Ouvrir electron/main.cjs

ğŸ”§ Ã‰TAPE 2: Remplacer 3 sections

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SECTION A: Gestionnaire de fermeture (ligne ~652)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚ Trouver:                                                    â”‚
â”‚ app.on('window-all-closed', () => {                        â”‚
â”‚   if (process.platform !== 'darwin') {                     â”‚
â”‚     if (dataManager) {                                      â”‚
â”‚       dataManager.saveData();                               â”‚
â”‚     }                                                       â”‚
â”‚     app.quit();                                             â”‚
â”‚   }                                                         â”‚
â”‚ });                                                         â”‚
â”‚                                                              â”‚
â”‚ Remplacer par le code de:                                  â”‚
â”‚ â†’ EXEMPLE_COMPLET_CORRECTION.js â†’ SECTION 1                â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SECTION B: Tous les ipcMain.handle (ligne ~663-765)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚ Chercher TOUS les patterns:                                â”‚
â”‚ ipcMain.handle('db-XXX', (...) => {                        â”‚
â”‚   return databaseService ? ... : dataManager...            â”‚
â”‚ });                                                         â”‚
â”‚                                                              â”‚
â”‚ Remplacer par le code de:                                  â”‚
â”‚ â†’ EXEMPLE_COMPLET_CORRECTION.js â†’ SECTION 3                â”‚
â”‚                                                              â”‚
â”‚ IMPORTANT: Faire Ã§a pour TOUS les handlers                 â”‚
â”‚ (environ 20 handlers)                                       â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SECTION C: Auto-save (ajouter aprÃ¨s createWindow)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚ Ajouter ce code dans app.whenReady().then()                â”‚
â”‚                                                              â”‚
â”‚ â†’ EXEMPLE_COMPLET_CORRECTION.js â†’ SECTION 2                â”‚
â”‚                                                              â”‚
â”‚ (Optionnel mais recommandÃ©)                                â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ’¾ Ã‰TAPE 3: Compiler

npm run build

âœ… Ã‰TAPE 4: Tester

1. Lancer le nouveau .exe
2. Ajouter 5 donnÃ©es (Personnel)
3. Fermer l'app (X ou Ctrl+Q)
4. Attendre 2-3 secondes
5. Rouvrir l'app
6. VÃ©rifier que les 5 donnÃ©es sont lÃ  âœ“


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                  FICHIERS DE RÃ‰FÃ‰RENCE                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“„ DATA_PERSISTENCE_FIX.md
   â†’ Diagnostic complet (pourquoi Ã§a se passe)
   â†’ Solutions dÃ©taillÃ©es
   â†’ Checklist
   Lire si: Vous voulez comprendre en profondeur

ğŸ”§ EXEMPLE_COMPLET_CORRECTION.js
   â†’ Code Ã  copier-coller (PRINCIPAL)
   â†’ Structure claire avec 3 sections
   â†’ PrÃªt Ã  utiliser
   Lire si: Vous voulez juste corriger rapidement

ğŸ“ CORRECTIONS_PERSISTANCE.js
   â†’ Explications dÃ©taillÃ©es pour chaque fix
   â†’ Points clÃ©s Ã  prendre en compte
   Lire si: Vous avez des questions

ğŸ” verify-persistence.js
   â†’ Script de vÃ©rification du code
   â†’ Detecte automatiquement les problÃ¨mes
   Utiliser: AprÃ¨s avoir appliquÃ© les corrections


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                  CHECKLIST D'IMPLÃ‰MENTATION                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â–¡ Ouvrir EXEMPLE_COMPLET_CORRECTION.js
â–¡ Ouvrir electron/main.cjs cÃ´te Ã  cÃ´te
â–¡ Copier Section 1 (window-all-closed handler)
â–¡ Remplacer les lignes 652-658 de main.cjs
â–¡ VÃ©rifier la syntaxe (pas d'erreurs)
â–¡ Copier Section 3 (ipcMain.handle)
â–¡ Remplacer tous les handlers (663-765)
â–¡ VÃ©rifier qu'il y a ~20 handlers remplacÃ©s
â–¡ Copier Section 2 (auto-save)
â–¡ Ajouter aprÃ¨s createWindow()
â–¡ Sauvegarder main.cjs
â–¡ npm run build
â–¡ Tester avec le .exe (5 donnÃ©es + fermeture + rÃ©ouverture)
â–¡ VÃ©rifier que les donnÃ©es persistent âœ“


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                  DIAGNOSTIC RAPIDE                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â“ Comment savoir si c'est le problÃ¨me?

1. Ouvrir l'app
2. Ajouter 1 personnel: "Test Data"
3. Menu â†’ DonnÃ©es â†’ Ouvrir dossier de donnÃ©es
4. Chercher le fichier cfp-data.json

Si cfp-data.json existe:
   â†’ BONNE NOUVELLE! Les donnÃ©es sont sauvegardÃ©es
   â†’ Le problÃ¨me est au redÃ©marrage (pas lu le fichier)
   â†’ Solution: MÃªme fix (remplacer handlers)

Si cfp-data.json n'existe PAS:
   â†’ Le problÃ¨me est la sauvegarde elle-mÃªme
   â†’ Solution: Appliquer le fix (section 1)

Si cfp-data.json existe MAIS ne contient pas "Test Data":
   â†’ Les donnÃ©es vont dans SQLite, pas JSON
   â†’ Solution: Appliquer le fix complet (sections 1-3)


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                  RÃ‰SUMÃ‰ DE LA SOLUTION                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

AVANT:
  DonnÃ©es â†’ SQLite OU JSON (alÃ©atoire)
       â†“
  Fermeture â†’ Sauvegarder JSON seulement
       â†“
  DonnÃ©es dans SQLite = PERDUES âŒ

APRÃˆS:
  DonnÃ©es â†’ TOUJOURS DataManager (JSON)
       â†“
  Fermeture â†’ Sauvegarder JSON + SQLite checkpoint
       â†“
  Toutes les donnÃ©es PERSISTÃ‰ES âœ“


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                  EN CAS DE PROBLÃˆME                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Si le problÃ¨me persiste aprÃ¨s les corrections:

1. ExÃ©cuter: node verify-persistence.js
   â†’ VÃ©rifier automatiquement votre code

2. VÃ©rifier la console lors de la fermeture:
   Doit afficher: "âœ… DonnÃ©es JSON sauvegardÃ©es avec succÃ¨s"

3. Chercher cfp-data.json Ã :
   C:\Users\<USERNAME>\AppData\Local\<NomApp>\cfp-data.json
   
   Si absent:
   â†’ ProblÃ¨me de permissions
   â†’ VÃ©rifier les droits d'Ã©criture sur AppData

4. Regarder les logs du .exe:
   â†’ Si erreurs, elles s'affichent dans la console

5. Tester en mode DEV:
   npm run dev
   â†’ Ajouter donnÃ©es + fermer + rÃ©ouvrir
   â†’ Si Ã§a marche en dev mais pas en .exe
   â†’ ProblÃ¨me de path ou permissions


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                  TEMPS ESTIMÃ‰                                 â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Diagnostic:        2 minutes â±ï¸
ImplÃ©mentation:   10 minutes â±ï¸
Compilation:       3 minutes â±ï¸
Test:              5 minutes â±ï¸
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
TOTAL:            ~20 minutes âœ“


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                  QUESTIONS/RÃ‰PONSES                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Q: Vais-je perdre les donnÃ©es existantes?
R: Non, elles seront relues au dÃ©marrage.

Q: Faut-il garder SQLite?
R: Non, DataManager (JSON) suffit. SQLite peut Ãªtre supprimÃ©.

Q: Combien de temps pour que Ã§a marche?
R: 20 minutes max.

Q: Et si j'ai d'autres problÃ¨mes?
R: VÃ©rifier DATA_PERSISTENCE_FIX.md section "ProblÃ¨mes potentiels"

Q: C'est grave comme problÃ¨me?
R: Critique en production, mais simple Ã  fixer.

Q: Pourquoi Ã§a n'a pas Ã©tÃ© dÃ©tectÃ© avant?
R: Double systÃ¨me (SQLite+JSON) crÃ©e une ambiguÃ¯tÃ© => conflit


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… TL;DR - RÃ©sumÃ© ultra-court:

1. Copier code de EXEMPLE_COMPLET_CORRECTION.js
2. Remplacer 3 sections dans electron/main.cjs
3. npm run build
4. Tester âœ“

C'est tout! ğŸ‰
